"use strict";(()=>{var e={};e.id=342,e.ids=[342],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},1081:e=>{e.exports=require("dotenv/config")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9648:e=>{e.exports=import("axios")},9713:(e,a,r)=>{r.a(e,async(e,o)=>{try{r.r(a),r.d(a,{config:()=>l,default:()=>i,routeModule:()=>u});var t=r(1802),n=r(7153),s=r(6249),d=r(867),c=e([d]);d=(c.then?(await c)():c)[0];let i=(0,s.l)(d,"default"),l=(0,s.l)(d,"config"),u=new t.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/onboarding",pathname:"/api/onboarding",bundlePath:"",filename:""},userland:d});o()}catch(e){o(e)}})},2515:(e,a,r)=>{r.a(e,async(e,o)=>{try{r.d(a,{u:()=>runOnboarding});var t=r(9437),n=r(5788),s=r(7931),d=e([t,n]);async function runOnboarding(e,a,r){console.log(`Starting onboarding for user ${e} (${a})`);try{console.log("Creating Flutterwave DVA...");let o=await (0,n.bb)(e,a);console.log(`DVA created: ${o.account_number}`),console.log("Creating BlockRadar dedicated address...");let d=await (0,t.O7)(r||a,{userId:e,email:a});console.log(`Crypto address created: ${d.address}`),console.log("Saving profile to database...");let{error:c}=await s.OQ.from("profiles").upsert({id:e,email:a,dva_account_number:o.account_number,dva_bank_name:o.bank_name,dva_account_name:o.account_name,usdc_address:d.address,erc20_address:d.address,updated_at:new Date().toISOString()});if(c)throw console.error("Profile creation error:",c),c;return console.log("Initializing crypto balance..."),await s.OQ.from("crypto_balances").upsert([{user_id:e,symbol:"USDC",amount:0,fiat_value:0}]),console.log(`Onboarding completed successfully for user ${e}`),{dva:o,cryptoAddress:{address:d.address,blockchain:d.blockchain,network:d.network}}}catch(e){throw console.error("Onboarding failed:",e.message),Error(`Onboarding failed: ${e.message}`)}}[t,n]=d.then?(await d)():d,o()}catch(e){o(e)}})},867:(e,a,r)=>{r.a(e,async(e,o)=>{try{r.r(a),r.d(a,{default:()=>handler});var t=r(2515),n=e([t]);async function handler(e,a){if("POST"!==e.method)return a.status(405).json({error:"Method not allowed"});let{userId:r,email:o,fullName:n}=e.body||{};if(!r||!o)return a.status(400).json({error:"userId and email required"});try{let e=await (0,t.u)(r,o,n);a.status(200).json({success:!0,data:e})}catch(e){console.error("Onboarding API error:",e),a.status(500).json({success:!1,error:e.message||String(e)})}}t=(n.then?(await n)():n)[0],o()}catch(e){o(e)}})}};var a=require("../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),r=a.X(0,[222,787,437],()=>__webpack_exec__(9713));module.exports=r})();